F.module("activity:skin/goddess",function(d,e,p){var g=d("superui:util/dot"),h=d("activity:activity/login"),l=d("superui:component/dialog"),o=d("superui:component/tips"),m=d("superui:component/share2"),f=d("activity:activity/log"),n=['<div class="s-star-profile">','<div class="s-star-baike">','<div class="s-star-title clearfix">','<h2 class="s-star-name">','<a href="/s?wd={{=it.name}}" target="_blank" data-log="starName" data-logparam="starId={{=it.starId}}">',"{{=it.name}}","</a>","</h2>",'<a href="http://vote.weibo.com/vid=2964281" target="_blank" data-starId="{{=it.starId}}" data-log="likeTa" data-logparam="starId={{=it.starId}}" class="s-star-like{{ if (it.likeTa === "true") { }} selected{{ } }}">喜欢她<i class="heart"></i></a>',"</div>","<ul>","{{~it.news :item:index}}","<li>",'<a href="{{=item.url}}" target="_blank" data-log="starRelatedLink" data-logparam="starId={{=it.starId}}">',"{{=item.title}}","</a>","</li>","{{~}}","</ul>","</div>",'<div class="s-star-skinHeat">','当前换肤数为：<span class="s-star-skin-num">{{=it.cNum}}</span>',"</div>","</div>",'<div class="s-star-video">','<div class="s-star-video-title">',"<h2></h2>",'<a href="http://tieba.baidu.com/f?kw=百度新首页&ie=utf-8" target="_blank" class="s-star-more" data-log="starMore" data-logparam="starId={{=it.starId}}">',"我想要更多的女神 >>","</a>","</div>",'<div class="s-star-video-wrap">','<a href="{{=it.video.url}}" class="play-btn" target="_blank" data-log="starVideo" data-logparam="starId={{=it.starId}}" hidefocus>','<i class="play-icon"></i>','<img src="{{=$.url.escapeSSL(it.video.src)}}" />',"</a>","</div>","</div>",'<span class="triangle tg-border"></span>','<span class="triangle tg-background"></span>'].join(""),j=g.template(n),b={1:45,2:90,3:135,4:180,5:225,6:270,7:315,8:360},i=$(window),q=false,a={x:0,y:0};function k(){}k.prototype={constructor:k,init:function(){this.initWidget();this.addEvent();this.showLog();this.initAnchor()},initWidget:function(){var x=this,u,s=2.8,t=0.9,r=0.9;if($.browser.ie===8){s=0.2;t=1.04;r=1.14}else{if($.browser.ie<8){s=1.6;t=0.92;r=0.96}}u=function(){var C=$(".roundabout-in-focus",this),B=a.x,G=a.y,A=[],D=0,z,E;x.updateProfile(C.attr("data-starId"),C.attr("data-starName"));$.each(this.children(),function(){var I=$(this),L=I.offset(),K=L.left,J=L.top,H=I.width()*I.attr("data-scale"),y=I.height()*I.attr("data-scale");if(K<=B&&B<(K+H)&&J<=G&&G<(J+y)){A.push(I)}});E=A[D];D=1;z=A.length;for(;D<z;D++){if(E.css("z-index")<A[D].css("z-index")){E=A[D]}}E.trigger("mouseenter")};$("#s-star-list ul").roundabout({minZ:1,maxZ:5,minOpacity:0.6,maxScale:1,minScale:0.6,focusBearing:3.8,childSelector:".s-star-item",tilt:-s,reflect:true,enableDrag:true,dropDuration:600,dropCallback:function(){u.apply(this,[])},width:t,height:r,clickToFocusCallback:function(){u.apply(this,[])}});var w=$(".lottery-share-to"),v;if(x.hasLogin()&&s_session.isUsedLadySkin==="true"){this.initFlash()}v=new m({useDefaultUI:false,url:$(".lottery-share-input").val(),title:w.attr("data-shareTitle"),pics:w.attr("data-sharePic")});v.init();$(".s-skin-lottery-turnable").rotate(0)},initFlash:function(){$.getScript(s_domain.staticUrl+"static/activity/js/lib/zeroclipboard_1c48fe5b.js",function(){var s=$(".lottery-share-input").val(),r=s_domain.staticUrl+"static/activity/swf/zeroclipboard_b4c04cc0.swf",t;ZeroClipboard.setMoviePath(r);t=new ZeroClipboard.Client();t.setHandCursor(true);t.setText(s);t.glue("share-copy");t.addEventListener("complete",function(u){if(!$(".sui-tips-copy-success").length){new o({componentWrap:$(".lottery-share-action"),target:$(u.domElement),identity:"copy-success",content:["复制成功"].join(""),align:"center",arrowLeft:"center",autoHide:true,autoShow:true,autoDestroy:true,hasClose:false,timing:1000,width:90,theme:"copy-success"})}f.send("click","copyLink")})})},addEvent:function(){var u=this,v=$("#s-star-list"),r='<span class="s-star-tips"></div>',t=['<div class="s-skin-lottery-verif">','<div class="verif-title">请键入方块中的字母</div>','<div class="verif-body">','<input type="text" id="verif-txt" placeholder="请输入验证码" maxLength=4 /><img src="'+s_domain.bs+'{{=it.imgUrl}}" data-src="'+s_domain.bs+'{{=it.imgUrl}}" id="verif-img" /><a href="javascript:;" class="verif-refresh"></a>',"</div>",'<div class="verif-submit">','<a href="#" class="verif-submit-btn" onclick="return false;">确定</a>',"</div>","</div>"].join(""),s=['<div class="s-star-nameTips" style="left: {{=it.left}}px; top: {{=it.top}}px">',"{{=it.starName}}",'<span class="triangle tg-border"></span>',"</div>"].join("");v.on("mouseenter mouseleave",'.s-star-item:not(".roundabout-in-focus")',function(A){var w=$(this),x=v.offset(),B=w.offset(),z,y;if(A.type==="mouseenter"){z=g.template(s);y=z({left:B.left-x.left+20,top:B.top-x.top-38,starName:w.attr("data-starName")});$(".s-star-nameTips").remove();v.append(y);$(".s-star-nameTips").css({left:B.left-x.left+(w.width()*w.attr("data-scale")-$(".s-star-nameTips").outerWidth())/2});$(".s-star-nameTips").animate({opacity:1},{duration:600,easing:"easeInOutQuad",complete:function(){}})}else{$(".s-star-nameTips").remove()}});$(".s-star-item").on("click",function(w){a={x:w.pageX,y:w.pageY}});$("#s-skin-immediGet").on("click",function(w){w.preventDefault();$("html, body").animate({scrollTop:1220},{duration:600,easing:"easeInOutQuad",complete:function(){}})});$(".s-star-name,.s-star-preview").on("click",function(y){y.preventDefault();var x=$(this),w=x.attr("data-starId");$("html, body").animate({scrollTop:1220},{duration:500,easing:"easeInOutQuad",complete:function(){var z;setTimeout(function(){z=$('#s-skin-star-list [data-starId="'+w+'"]').parent();u.switchTab(z,w)},200)}});f.send("click","starPreview","starId="+w)});$("#s-skin-star-list").on("click",'li:not(".cur") a',function(z){z.preventDefault();var x,y,w;x=$(this);w=x.attr("data-starId");y=x.parent();u.switchTab(y,w)});$("#s-skin-pic-list").on("click","ul.cur div.s-skin-plus-border,a",function(A){A.preventDefault();var z=$(this).closest("li"),w=z.parent().attr("data-starId"),y=z.attr("data-skinId"),x;if(y){u.preview(w,y);z.siblings().removeClass("active").find(".s-skin-plus-border").remove();z.addClass("active");u.addBorder(z);f.send("click","skinPreview","skinId="+y+";starId="+w)}}).on("mouseenter mouseleave",'ul.cur li:not(".active")',function(x){var w=$(this);if(x.type==="mouseenter"){u.addBorder(w);w.addClass("hover")}else{u.delBorder(w);w.removeClass("hover")}});$(".s-skin-setting-btn").on("click",function(y){y.preventDefault();var z=$("#s-skin-desktop"),w,x;w=z.attr("data-starId");x=z.attr("data-skinId");u.setSkinByIndex(false,x);f.send("click","setHomeSkin","skinId="+x+"; starId=1010-"+w)});$("#s-skin-elevator").on("click",'li:not(".cur") a',function(A){A.preventDefault();var y=$(this),x=$("html, body"),w=y.parent(),z=0;if(w.hasClass("s-skin-floor-1")){z=370}else{if(w.hasClass("s-skin-floor-2")){z=1200}else{if(w.hasClass("s-skin-floor-3")){z=1880}else{if(w.hasClass("s-skin-floor-4")){z=$(document).height()}}}}w.addClass("cur");w.siblings().removeClass("cur");q=true;x.animate({scrollTop:z},{duration:400,easing:"easeInOutQuad",complete:function(){q=false}})});$(".s-skin-lottery-btn").on("click",function(z){z.preventDefault();var y=$(this),x=$(".s-skin-lottery-turnable"),w=s_session.isUsedLadySkin==="true"?"":" hidden";if(!y.hasClass("disabled")){if(u.hasLogin()){u.lotteryIsAvailable().done(function(B){var A;if(B.bsResult.status==2){try{h.login(function(){f.send("click","login");setTimeout(function(){var D=location.href.replace(/(&|\?)from_login=1/,"");window.location.href=D+(D.indexOf("?")>-1?"&":"?")+"from_login=1"})})}catch(C){}}else{if(B.bsResult.status==0){A=new l({content:['<div class="emot"></div>',"<p>"+$.decodeHTML(B.bsResult.statusText)+"</p>",'<p class="skin-lottery-txt">邀请3位好友成功换肤，即可参与抽奖哦~</p>','<p class="skin-lottery-txt last">iPhone6、明星好礼送不停！</p>','<div class="lottery-fail-share share-wrapper'+w+'">','分享给好友获取更多抽奖机会<span class="label">分享至</span>','<span class="sns-item share-weibo" data-share="tsina"></span>','<span class="sns-item share-weixin" data-share="weixin"></span>','<span class="sns-item share-qzone" data-share="qzone"></span>','<span class="sns-item share-baidu" data-share="tieba"></span>','<span class="sns-item share-tqq" data-share="tqq"></span>',"</div>"].join(""),width:480,identity:"lottery-fail",dialogClassName:"s-skin-lottery-fail",theme:"lottery-fail"});A.on("acting-close",function(){A.close()})}else{if(B.bsResult.status==3){A=new l({content:['<div class="emot"></div>',"<p>"+$.decodeHTML(B.bsResult.statusText)+"</p>",'<div class="lottery-fail-share share-wrapper'+w+'">','分享给好友获取更多抽奖机会<span class="label">分享至</span>','<span class="sns-item share-weibo" data-share="tsina"></span>','<span class="sns-item share-weixin" data-share="weixin"></span>','<span class="sns-item share-qzone" data-share="qzone"></span>','<span class="sns-item share-baidu" data-share="tieba"></span>','<span class="sns-item share-tqq" data-share="tqq"></span>',"</div>"].join(""),width:480,identity:"lottery-fail",dialogClassName:"s-skin-lottery-fail",theme:"lottery-fail"});A.on("acting-close",function(){A.close()})}else{u.getVerifCode().done(function(J){J=J.bsCaptcha;var E=J.imgUrl,I=J.token;if(J.hasCap==0){u.lottery(y)}else{var D,H,G;D=g.template(t);H=D(J);G=new l({content:H,width:306,identity:"verif-code",dialogClassName:"s-skin-lottery-verif",theme:"lottery-verif"});G.on("acting-close",function(){G.close()});$(".verif-refresh,#verif-img").on("click",function(){var K=$("#verif-img"),L=K.attr("data-src")||"";if(L.indexOf("?")>-1){L+="&t="+ +new Date()}else{L+="?t="+ +new Date()}K.attr("src",L)});$("#verif-txt").on("keyup",function(){var K=$(this),L=$(".verif-refresh");if($.trim(K.val()).length===4){$.ajaxpost(s_domain.baseuri+"/skin/submit/activitychecap",{captcha:K.val(),token:I},function(M){if(M.errNo==0){if(parseInt(M.bsResult.status,10)===1){L.removeClass("error").addClass("ok")}else{L.removeClass("ok").addClass("error");L.trigger("click")}}})}});$(".verif-submit-btn").on("click",function(M){var K=$("#verif-txt"),L=$(".verif-refresh");if($.trim(K.val()).length===4){$.ajaxpost(s_domain.baseuri+"/skin/submit/activitychecap",{captcha:K.val(),token:I},function(N){if(N.errNo==0){if(parseInt(N.bsResult.status,10)===1){L.removeClass("error").addClass("ok");G.close();u.lottery(y,K.val(),I)}else{L.removeClass("ok").addClass("error");L.trigger("click")}}})}else{L.removeClass("ok").addClass("error")}M.preventDefault()});$("#verif-txt").focus()}})}}}})}else{try{h.login(function(){f.send("click","login");setTimeout(function(){var A=location.href.replace(/(&|\?)from_login=1/,"");window.location.href=A+(A.indexOf("?")>-1?"&":"?")+"from_login=1"})})}catch(z){}}}});$('.lottery-share-input:not(".disabled")').on("mouseenter mouseleave",function(w){if(w.type==="mouseenter"){if(u.hasLogin()&&s_session.isUsedLadySkin==="true"){$(this).select()}}});$(".lottery-share-tips").on("click",".to-experience",function(){$("#s-skin-elevator li:nth-child(2) a").trigger("click")});$("#s-star-summary").on("click",'.s-star-like:not(".selected")',function(){var w=$(this);if(!w.hasClass("selected")){w.addClass("selected")}$.ajaxpost("/home/skin/submit/activitylikeshe",{starId:w.attr("data-starId")},function(x){})});i.on("scroll",this.throttle(function(){if(q){return}var w=$("#s-skin-elevator li");$.each([".s-star-wrap",".s-skin-yulan",".s-skin-lottery",".s-skin-rules"],function(z,y){var B=$(y),A=B.offset().top,x=A+B.height(),C;C=i.scrollTop();if(C+i.height()>=$(document).height()){w.removeClass("cur").eq(3).addClass("cur")}else{if(C>=A&&C<x){w.removeClass("cur").eq(z).addClass("cur");return false}}})},200));i.trigger("scroll");$("#share-copy").on("click",function(w){w.preventDefault();return u.shareValid()});$(".lottery-share-to").on("click",".sns-item",function(){return u.shareValid()})},initAnchor:function(){var s,u,r,t;s=(location.href||"").match(/(?:anchor)=[^&]+/ig);if(s){u=s[0]||"";r=u.split("=");t=r[1];switch(t){case"lottery":$(".s-skin-floor-3 a").trigger("click");break;default:break}}},showLog:function(){f.send("show","middlePageShow")},shareValid:function(){var r=$(".lottery-share-tips");if(!this.hasLogin()){r.html('<p>换肤并登录成功后才可分享好友，<a href="javascript:;" class="to-experience">去体验换肤！</a>成功分享并邀请好友换肤可</p><p>获得更多抽奖机会哦！</p>');return false}if(s_session.isUsedLadySkin==="false"){r.html('<p>换肤成功才可分享好友，<a href="javascript:;" class="to-experience">去体验换肤！</a>成功分享并邀请好友换肤可获得更多</p><p>获得更多抽奖机会哦！</p>');return false}return true},updateProfile:function(t,r){var s=$("#s-star-summary");$.ajaxget(s_domain.baseuri+"/skin/data/activitysinfo?lid="+t,function(v){if(v.errNo==0){if(v.bsInfo){var u=j(v.bsInfo);s.fadeOut(600,function(){s.html(u);s.fadeIn(300)})}}else{}})},switchTab:function(r,s){var u=this,t,v;r.siblings().removeClass("cur").end().addClass("cur");setTimeout(function(){t=$('#s-skin-pic-list ul[data-starId="'+s+'"]');t.addClass("cur").siblings("ul").removeClass("cur");r=t.find("li.active");if(!r.length){r=t.find("li:first");r.addClass("active")}if($("#s-skin-desktop").attr("data-skinId")!==r.attr("data-skinId")){u.addBorder(r);u.preview(s,r.attr("data-skinId"))}},0)},preview:function(r,t){if(r&&t){var s=$.url.escapeSSL("http://1.su.bdimg.com/skin/"+t+".jpg?2");$("#s-skin-desktop").css({"background-image":"url("+s+")",filter:'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+s+'", sizingMethod="scale")'}).attr("data-skinId",t).attr("data-starId",r)}},addBorder:function(r){var s='<div class="s-skin-plus-border"></div>';this.delBorder(r);r.append(s)},delBorder:function(r){$(".s-skin-plus-border",r).remove()},setSkinByIndex:function(u,t){var s=this,r=(location.href||"").match(/(?:super_frm|from_reg|from_login)=[^&]+/ig),w=[169,170,171];u&&r.push(u);if(this.hasLogin()){$.each(w,function(x,y){$.ajaxpost(s_domain.baseuri+"/xman/submit/tipsplusupdate",{id:y,type:1},function(z){})});setTimeout(function(){window.location.href=s_domain.bs+"/home/skin/submit/setuskinforactivity?skinId="+t+(r?"&"+r[0]:"")+"&frm=activitygoddess"},200)}else{try{h.login(function(){$.each(w,function(x,y){$.ajaxpost(s_domain.baseuri+"/xman/submit/tipsplusupdate",{id:y,type:1},function(z){})});s.setSkin(t);f.send("click","login")},"skinId="+t)}catch(v){}}},setSkin:function(s){var r=this;setTimeout(function(){var t=(location.href||"").match(/(?:super_frm)=[^&]+/ig);window.location.href=s_domain.bs+"/home/skin/submit/setuskinforactivity?skinId="+s+(t?"&"+t[0]:"")+"&from_login=1&frm=activitygoddess"},800)},hasLogin:function(){return !$(".s-login").length},lotteryIsAvailable:function(){var s=this,r=$.Deferred();$.ajaxget(s_domain.baseuri+"/skin/data/activitychecklott",function(t){if(t.errNo==0){r.resolveWith(s,[t])}else{}});return r.promise()},getVerifCode:function(){var s=this,r=$.Deferred();$.ajaxget(s_domain.baseuri+"/skin/data/activityimgcap",function(t){if(t.errNo==0){r.resolveWith(s,[t])}else{}});return r.promise()},lottery:function(t,r,s){var u=this;r=r||"";s=s||"";if(!t.hasClass("disabled")){t.text("抽奖中...");$.ajaxpost(s_domain.baseuri+"/skin/submit/activitylott",{captcha:r,token:s},function(v){if(v.errNo==0){u._lottery(b[v.bsResult.prizeCode],function(){t.text("立即抽奖");t.removeClass("disabled");var y,w=$(".s-skin-lottery-changeNum"),x=parseInt(w.text(),10);if(parseInt(v.bsResult.prizeCode,10)===5){y=new l({content:['<div class="emot"></div>',"<h2>很遗憾</h2>","<p>"+$.decodeHTML(v.bsResult.statusText)+"</p>",'<div class="lottery-fail-share share-wrapper">','分享给好友获取更多抽奖机会<span class="label">分享至</span>','<span class="sns-item share-weibo" data-share="tsina"></span>','<span class="sns-item share-weixin" data-share="weixin"></span>','<span class="sns-item share-qzone" data-share="qzone"></span>','<span class="sns-item share-baidu" data-share="tieba"></span>','<span class="sns-item share-tqq" data-share="tqq"></span>',"</div>"].join(""),width:480,identity:"lottery-fail",dialogClassName:"s-skin-lottery-fail",theme:"lottery-fail"})}else{y=new l({content:['<h2 class="prize-icon"></h2>','<div class="prize-name">'+$.decodeHTML(v.bsResult.statusText)+"</div>",'<div class="lottery-winning-extra">','<a href="/home/xman/show/activityprecious" target="_blank" class="myPrize">去我的奖品查看</a>','<a href="http://tieba.baidu.com/f?kw=更多&fr=fenter&prequery=我想要更多的女神" target="_blank">我是逢奖必晒控</a>',"</div>"].join(""),width:480,identity:"lottery-winning",dialogClassName:"s-skin-lottery-winning",theme:"lottery-winning"})}x--;if(x>=0){w.text(x)}})}});t.addClass("disabled")}},_lottery:function(w,x){var v=this,u=0,r=[];function t(B,A,z){var y=B||250,A=A||250,z=z||$.noop;r.push(setTimeout(function(){$(".s-skin-lottery-turnable").rotate(45);z(45)},y));y+=A;r.push(setTimeout(function(){$(".s-skin-lottery-turnable").rotate(90);z(90)},y));y+=A;r.push(setTimeout(function(){$(".s-skin-lottery-turnable").rotate(135);z(135)},y));y+=A;r.push(setTimeout(function(){$(".s-skin-lottery-turnable").rotate(180);z(180)},y));y+=A;r.push(setTimeout(function(){$(".s-skin-lottery-turnable").rotate(225);z(225)},y));y+=A;r.push(setTimeout(function(){$(".s-skin-lottery-turnable").rotate(270);z(270)},y));y+=A;r.push(setTimeout(function(){$(".s-skin-lottery-turnable").rotate(315);z(315)},y));y+=A;r.push(setTimeout(function(){$(".s-skin-lottery-turnable").rotate(360);z(360);u++;switch(u){case 1:case 2:t(120,120);break;case 3:if(w===45){s()}else{t(250,500,function(C){if(C===w-45){s()}})}break;default:break}},y))}function s(){for(var y=0;y<r.length;y++){clearTimeout(r[y])}setTimeout(function(){x()},500)}t(200,200)},throttle:function(s,u,y){var r,w,z;var x=null;var v=0;if(!y){y={}}var t=function(){v=y.leading===false?0:+new Date();x=null;z=s.apply(r,w);if(!x){r=w=null}};return function(){var A=+new Date();if(!v&&y.leading===false){v=A}var B=u-(A-v);r=this;w=arguments;if(B<=0||B>u){clearTimeout(x);x=null;v=A;z=s.apply(r,w);if(!x){r=w=null}}else{if(!x&&y.trailing!==false){x=setTimeout(t,B)}}return z}}};var c=new k();e.init=function(){c.init()}});F.call("activity:skin/goddess","init");